---
title: "LSI and clustering of peak matrix"
output: html_notebook
---

# Compute and save peak matrix

## Make pseudo-bulk replicates

Don't run this in parallel.

```{r}
proj2 = loadArchRProject("Save-Proj2/")

proj4 <- addGroupCoverages(
  ArchRProj = proj2,
  groupBy = "Clusters2")
```

## Call peaks w/ Macs2

```{r}
pathToMacs2 <- "/usr/local/anaconda2/bin/macs2"
```

Below took 282.13 mins

```{r}
Sys.setenv(HDF5_USE_FILE_LOCKING = "FALSE")
proj4 <- addReproduciblePeakSet(
    ArchRProj = proj4, 
    groupBy = "Clusters2",
    pathToMacs2 = pathToMacs2,
    # genomeSize = 2743300000 # rn6
    genomeSize = 2626580772 # rn7
)

getPeakSet(proj4)
```

## Add peak matrix

```{r}
# saveArchRProject(
#   ArchRProj = proj4,
#   outputDirectory = "Save-Proj4",
#   load = FALSE)
proj4 = loadArchRProject("Save-Proj4/")

# # This needs executed only once
# addPeakMatrix(proj4)

getAvailableMatrices(proj4)
```
